<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>lexdiff 웹 인터페이스</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      body {
        background-color: #f7f8fa;
      }
      .diff-table {
        font-size: 0.9rem;
      }
      .diff-table th {
        white-space: nowrap;
      }
      .diff-table td {
        vertical-align: top;
      }
      .operation-type-add {
        color: #198754;
        font-weight: 600;
      }
      .operation-type-delete {
        color: #dc3545;
        font-weight: 600;
      }
      .operation-type-replace {
        color: #fd7e14;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="container py-5">
      <h1 class="mb-4 text-center">lexdiff 웹 인터페이스</h1>
      <p class="lead text-center mb-5">
        DOCX 문서를 업로드하여 하이라이트 결과와 CSV 변경 리스트를 바로 다운로드하세요.
      </p>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="alert alert-warning" role="alert">
            {% for message in messages %}
              <div>{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <div class="card shadow-sm mb-5">
        <div class="card-body">
          <form method="post" enctype="multipart/form-data">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="source" class="form-label">원본 DOCX</label>
                <input class="form-control" type="file" id="source" name="source" accept=".docx" required />
              </div>
              <div class="col-md-6">
                <label for="target" class="form-label">수정 DOCX</label>
                <input class="form-control" type="file" id="target" name="target" accept=".docx" required />
              </div>
            </div>

            <div class="row g-3 mt-3">
              <div class="col-md-4">
                <label for="threshold" class="form-label">임계값 (0~1)</label>
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  max="1"
                  class="form-control"
                  id="threshold"
                  name="threshold"
                  value="{{ form.threshold or '0.8' }}"
                />
              </div>
              <div class="col-md-4">
                <label class="form-label">무시 옵션</label>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="punct"
                    id="ignorePunct"
                    name="ignore"
                    {% if 'punct' in ignore_selected %}checked{% endif %}
                  />
                  <label class="form-check-label" for="ignorePunct">구두점 무시</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="space"
                    id="ignoreSpace"
                    name="ignore"
                    {% if 'space' in ignore_selected %}checked{% endif %}
                  />
                  <label class="form-check-label" for="ignoreSpace">공백 무시</label>
                </div>
              </div>
              <div class="col-md-4">
                <label for="docx_name" class="form-label">DOCX 파일명</label>
                <input
                  class="form-control"
                  type="text"
                  id="docx_name"
                  name="docx_name"
                  value="{{ form.docx_name or 'lexdiff_result.docx' }}"
                />
                <label for="csv_name" class="form-label mt-2">CSV 파일명</label>
                <input
                  class="form-control"
                  type="text"
                  id="csv_name"
                  name="csv_name"
                  value="{{ form.csv_name or 'lexdiff_diff.csv' }}"
                />
              </div>
            </div>

            <div class="text-end mt-4">
              <button type="submit" class="btn btn-primary btn-lg">비교 실행</button>
            </div>
          </form>
        </div>
      </div>

      {% if summary %}
        <div class="card shadow-sm mb-4">
          <div class="card-body">
            <h2 class="h5">요약</h2>
            <div class="d-flex gap-4">
              <div><span class="operation-type-add">추가</span>: {{ summary.add }}</div>
              <div><span class="operation-type-delete">삭제</span>: {{ summary.delete }}</div>
              <div><span class="operation-type-replace">수정</span>: {{ summary.replace }}</div>
            </div>
          </div>
        </div>
      {% endif %}

      {% if operations %}
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h2 class="h5 mb-0">변경 사항 미리보기</h2>
              <div class="btn-group">
                <a class="btn btn-outline-secondary" href="{{ url_for('download', token=token, fmt='docx') }}">DOCX 다운로드</a>
                <a class="btn btn-outline-secondary" href="{{ url_for('download', token=token, fmt='csv') }}">CSV 다운로드</a>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table table-striped table-bordered diff-table align-middle">
                <thead class="table-light">
                  <tr>
                    <th scope="col">유형</th>
                    <th scope="col">유사도</th>
                    <th scope="col">원본</th>
                    <th scope="col">수정</th>
                    <th scope="col">A 인덱스</th>
                    <th scope="col">B 인덱스</th>
                  </tr>
                </thead>
                <tbody>
                  {% for op in operations %}
                    <tr>
                      <td class="operation-type-{{ op.type }}">{{ op.type }}</td>
                      <td>{{ op.sim }}</td>
                      <td>{{ op.original }}</td>
                      <td>{{ op.revised }}</td>
                      <td>{{ op.idxA }}</td>
                      <td>{{ op.idxB }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      {% elif token %}
        <div class="alert alert-info" role="alert">
          변경 사항이 없습니다. 그래도 아래 버튼으로 결과 파일을 내려받을 수 있습니다.
          <div class="mt-2">
            <a class="btn btn-outline-secondary me-2" href="{{ url_for('download', token=token, fmt='docx') }}">DOCX 다운로드</a>
            <a class="btn btn-outline-secondary" href="{{ url_for('download', token=token, fmt='csv') }}">CSV 다운로드</a>
          </div>
        </div>
      {% endif %}
    </div>
  </body>
</html>
